
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Tyler">
      
      
        <link rel="canonical" href="https://www.activedirectorykc.net/2021/04/22/configuring-the-ad-site-topology-for-non-routed-networks/">
      
      
        <link rel="prev" href="../../../../2020/08/24/cannot-bind-argument-to-parameter-exception-because-it-is-null-with-backup-bitlockerkeyprotector/">
      
      
      
        
      
      
      <link rel="icon" href="../../../../assets/ADKC_LittleIcon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Configuring the AD Site Topology for Non-Routed Networks - ActiveDirectoryKC.NET</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/custom.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lab-setup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="ActiveDirectoryKC.NET" class="md-header__button md-logo" aria-label="ActiveDirectoryKC.NET" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ActiveDirectoryKC.NET
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Configuring the AD Site Topology for Non-Routed Networks
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="amber"  aria-label="dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="amber"  aria-label="light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ActiveDirectoryKC" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../about/" class="md-tabs__link">
        
  
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://reddit.com/r/ActiveDirectory/wiki" class="md-tabs__link">
        
  
  
    
  
  Reddit-AD-Wiki

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../archive/2021/" class="md-tabs__link">
          
  
  
    
  
  Archive

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="ActiveDirectoryKC.NET" class="md-nav__button md-logo" aria-label="ActiveDirectoryKC.NET" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>

    </a>
    ActiveDirectoryKC.NET
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ActiveDirectoryKC" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://reddit.com/r/ActiveDirectory/wiki" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reddit-AD-Wiki
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2021
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2020
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../.." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2021-04-22 00:00:00+00:00" class="md-ellipsis">April 22, 2021</time>
                      </div>
                    </li>
                    
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              18 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lab-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lab Setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disclaimer-1-proper-site-design" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disclaimer #1 – Proper Site Design
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-it-all-before-breaking-it-all" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing it All Before Breaking it All
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sites-and-services-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sites and Services Setup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disclaimer-2-risks-of-change-notify" class="md-nav__link">
    <span class="md-ellipsis">
      
        DISCLAIMER #2 – Risks of Change Notify
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DISCLAIMER #2 – Risks of Change Notify">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-change-notification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuring Change Notification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuring Change Notification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-method" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual Method
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-method" class="md-nav__link">
    <span class="md-ellipsis">
      
        PowerShell Method
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disclaimer-3-why-are-you-not-routing-your-sites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disclaimer #3 – Why Are You Not Routing Your Sites?
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-non-routed-site-design" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating a Non-Routed Site Design
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating a Non-Routed Site Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disabling-bridge-all-site-links" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disabling Bridge All Site Links
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Disabling Bridge All Site Links">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disabled-via-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disabled via Powershell
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changing-how-ad-srv-records-are-registered" class="md-nav__link">
    <span class="md-ellipsis">
      
        Changing How AD SRV Records are Registered
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#digging-deeper" class="md-nav__link">
    <span class="md-ellipsis">
      
        Digging Deeper
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Digging Deeper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-firewall-configuration-to-lock-down-child-domains" class="md-nav__link">
    <span class="md-ellipsis">
      
        Windows Firewall Configuration to Lock Down Child Domains
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#site-links-vs-site-link-bridges" class="md-nav__link">
    <span class="md-ellipsis">
      
        Site Links vs Site Link Bridges
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpo-settings-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        GPO Settings Overview
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  



  
  


  <h1>Configuring the AD Site Topology for Non-Routed Networks</h1>

<p>Over the past year, I have been in a number of conversations about setting up Active Directory Sites and Services in a network that is not fully routed. Articles exist on the subject — some from Microsoft and some not. All the articles seem to skip a step or don’t linger on a detail I’d like to expand on.</p>
<p>The question of “How do I configure Active Directory in a non-routed environment?” isn’t uncommon. With more organizations segmenting out their networks, with more B2B contracts encouraging companies to play well with one another, or whatever the need to ensure that AD plays across confusing site designs is imperative.</p>
<p>Fortunately, there resources and articles out that detailing just this sort of thing. Unfortunately, like all things, they are often incomplete or gloss over an important step. Even more unfortunate, with Microsoft’s recent drive to remove “outdated” documentation some of the gems of the past have gone missing. I hope to give some insight into how to configure AD to work with non-routed or poorly routed networks. I will focus on the Sites and Services side and give some guidance on the GPOs, firewall policies, and as many details that make sense as I dig into it.</p>
<!-- more -->

<h2 id="lab-setup">Lab Setup</h2>
<p>have a CORP domain with two sites, CORP and WAREHOUSE (WH), and two child domains spun off of the CORP parent, RETAIL and OPS. RETAIL and OPS need to be segregated from each other and from WAREHOUSE. Everyone needs to be able to talk back and forth with the CORP site.</p>
<p>Each site has its own subnet in my design. The subnets are routed in my lab since that is how my lab is setup. Rather than breaking the routes I’m using Windows Firewall to block MS-RPC and LDAP traffic between the sites and warehouse.</p>
<p>Another thing worth mentioning is I disabled Bridge All Site Links (BASL) and changed how DCs create SRV records. I’ll explain why I did this below but understand that it is a crucial part to how this whole thing is architected.</p>
<p>Last, the specific details about the lab (number of DCs, DC hardware, etc.) are left out. It shouldn’t matter in this step. All that matters is that every site has a DC and every DC has a site.</p>
<h3 id="disclaimer-1-proper-site-design">Disclaimer #1 – Proper Site Design</h3>
<p>I’ve looked at a lot of environments and worked with a lot of admins trying to make their AD work like a charm. One of the most neglected, yet critical, pieces of a proper AD setup is the Site and Services configuration. This is even more prevalent in medium-sized organizations and larger as they tend to have more sites and thus more complexity. Admins tend to setup AD Sites and Services with the out-of-the-box defaults and it just works. Why change it? Or, they don’t understand it enough to change it with confidence.</p>
<p>For a non-routed AD topology to work, your Sites and Services must be solid. If it isn’t there will be issues. Map your subnets to their sites, ensure that proper sites are configured, make sure that ever site has a DC, etc. These are all import. However, you must understand your network topology appropriately and make sure that that topology is correctly mirrored in AD Sites and Services (within reason).</p>
<h3 id="testing-it-all-before-breaking-it-all">Testing it All Before Breaking it All</h3>
<p>Before breaking an environment it is important to know that said environment works. I want my directory full converged with all DCs having successful replications and a DNS that resolves as I would expect.</p>
<p>I ran the following checks on every DC to verify everything worked. If these come back without errors it is likely all things are peachy.</p>
<div class="highlight"><pre><span></span><code>dcdiag
Repadmin /showrepl /errorsonly
Repadmin /replsum
Nltest /dsgetdc:
Nltest /dsgetdc: /avoidself
Nltest /dsgetdc:company.pri
Nltest /dsgetdc:retail.company.pri
Nltest /dsgetdc:ops.company.pri
</code></pre></div>
<h3 id="sites-and-services-setup">Sites and Services Setup</h3>
<p>Each of the sites I mentioned above were created with their own /24 subnet. Site Links were created back to the CORP site. To make sure replication worked as I expected, I wanted to make sure that each site link has both a low cost and have a short replication interval. I also went through and configured change notification on each site link.</p>
<p>The default cost is 100 and the default replication interval is 180 minutes. That is fine, but I like to change those  numbers. Three hours for convergence with just one set of links is not fast enough for my setup. Remember that site link costs are cumulative. Assuming for a moment that I wanted WAREHOUSE to replicate something with RETAIL they have to cross between CORP to do that. This means that with a replication period of 180 minutes for each site link it could take a total of 360 minutes for the change in WAREHOUSE to get to RETAIL. Let’s change the defaults. Change notification gets around some of this but we want the replication costs set right. Some stuff will always use that even with notify turned on.</p>
<p><img alt="" src="https://activedirectorykc.wordpress.com/wp-content/uploads/2022/08/1_default_sitelink_configuration.png?w=528" /></p>
<p>Altering the cost and replication interval of the site links is very straight forward. I’ll set the cost to 50 and the interval to the lowest possible value: 15. I’ll be using PowerShell to do this, it is a one-and-done method that has a lot fewer clicks.</p>
<div class="highlight"><pre><span></span><code>Get-ADReplicationSiteLink -Filter * | Set-ADReplicationSiteLink -Cost 50 -ReplicationFrequencyInMinutes 15
</code></pre></div>
<p>The above command first grabs all the Site Links in the forest (remember Sites and Services is a forest-wide part of AD). I then send those to Set-ADReplicationSiteLink and alter the cost and the replication frequency.</p>
<p>Next, it is time to enable change notification on the site links. Within a site change notification is the default. Changing site links to behave the same way effectively makes the DCs all act as if they are in one site, even though great distances may be between them. This all means that the DCs in all my sites will converge very quickly, likely under a minute.</p>
<p>Change Notification tells domain controllers to notify replication partners immediately upon receiving a change. If I add a user to a new group, in this scenario, the DC would notify its partners immediately that the change happened and then they would request the change be replicated. Without change notification the DCs store up changes and send all the data as a big chunk of replication traffic at every replication interval. Rather than communicating larger pieces of information periodically change notification communicates with a frequent, but small, series of notifications about changes.</p>
<p>I changed change notification because Microsoft has been recommending it for most environments for years. Smaller environments may not even need it as they are unlikely to have multiple sites. Medium and larger environments could benefit from it assuming their sites are well-connected.</p>
<h3 id="disclaimer-2-risks-of-change-notify">DISCLAIMER #2 – Risks of Change Notify</h3>
<p>First, DCs are more chatty. They send little pieces of information rather than large pieces. Bandwidth-wise this shouldn’t matter all that much but I have seen cases where it wasn’t an ideal setup.</p>
<p>Second, if you have already configured options on your site link (you will know if you have) if you blindly follow my steps you can blow away what you currently have which may not be ideal. The options field uses bitmasks. If you have any concerns about blowing something away, check the References section below for some notes and do some of your own research beforehand.</p>
<p>Finally, another risk of change notify is speed of changes. In a standard replication model, if I were to change the group membership of a user it would queue up that change and send it during the replication interval later. If I were to change that user’s group membership a second time before the interval hit, both changes go through. If that second change were to remove the user from the group I had just added them to, only the second changes goes through as AD would only send what was relevant. Change notification will make it where each change along the course of work will be near immediately replicated. So your mistakes may become environment-wide mistakes faster with change notification on. This is a minor risk as most changes are rather non-impacting on their own, but keep all that in mind as you go forward.</p>
<p><img alt="" src="https://activedirectorykc.wordpress.com/wp-content/uploads/2022/08/2_changenotify_manual_gui.png?w=402" /></p>
<h4 id="configuring-change-notification">Configuring Change Notification</h4>
<h5 id="manual-method">Manual Method</h5>
<ol>
<li>Right-Click the Site Link \ Properties</li>
<li>Attribute Editor Tab</li>
<li>Locate the Options Attribute</li>
<li>Edit “Options”</li>
<li>Set the value to “1”</li>
<li>Options should now show “0x1 = (USE_NOTIFY)”</li>
</ol>
<h5 id="powershell-method">PowerShell Method</h5>
<div class="highlight"><pre><span></span><code>Get-ADReplicationSiteLink -Filter * | Set-ADReplicationSiteLink -Add @{&quot;options&quot;=1}
</code></pre></div>
<p>In the Powershell method I set it for every site link at once. I also hope you noticed there isn’t a -UseNotify or -Options switch on the command. Microsoft decided to make this command a little complicated. Fortunately, the -Add switch and its kindred allows us to do just about whatever we need to the attributes on this object type.</p>
<h3 id="disclaimer-3-why-are-you-not-routing-your-sites">Disclaimer #3 – Why Are You Not Routing Your Sites?</h3>
<p>We are now ready to start creating a non-routed site and services topology. But first, I want to ask the question: <strong>Why are you not routing your sites?</strong></p>
<p>A lot of organizations I’ve worked with do this because of “security” reasons. Tenant A shouldn’t be able to talk to Tenant B. If that is the case, while this design accomplishes that goal the best practice is to create separate forests. AD assumes all sites and domains in a forest can talk with one another, at least to some degree. If you break those sites or domains off into their own forests, there is no assumption of communication. I know there are some administrative hurdles there but those are not something that can’t be dealt with.</p>
<p>I’m not saying that you are chosing a bad design, I’m simply asking that you consider moving forward cautiously. Make sure you understand why you want to do this and that it makes the best sense for your environment. There is rule of thumb with AD, even a blog post about it from Microsoft: You are not smarter than the KCC. So let it do what it does.</p>
<p><a href="https://docs.microsoft.com/en-us/archive/blogs/markmoro/you-are-not-smarter-than-the-kcc">https://docs.microsoft.com/en-us/archive/blogs/markmoro/you-are-not-smarter-than-the-kcc</a></p>
<p>Okay, that is my final warning before we start doing this.</p>
<h2 id="creating-a-non-routed-site-design">Creating a Non-Routed Site Design</h2>
<p>As I said before, rather than configuring my Vyos lab router to not route between my /24 links, I decided to use the Windows Defender Firewall to block LDAP 389 and the RPC Dynamic Port Range (49152 – 65535) for each domain. I only blocked it inbound on the other domains controllers. I have more details on this and some its challenges in the “Dig Deeper” section at the end of this post.</p>
<p>This method is not the recommended way to firewall off sites and I only did it out of convenience. If you wanted to do this in production, work with your network team and properly route/firewall your network.</p>
<h3 id="disabling-bridge-all-site-links">Disabling Bridge All Site Links</h3>
<p>By default Active Directory bridges all site links together. This allows every site to have a “direct” connection with every other site which means AD will create connections between sitelinks to create a intersite mesh topology of sorts. It also ensure that replication can go in virtually any direction. Remember the goal of the ISTG and KCC in this case to ensure the topology that achieves convergence as quickly as possible.</p>
<p>In a normal environment, Bridge All Site Links (BASL) should be left on. It works and most environments don’t do anything weird with their sites like this. That being said, Microsoft does have two scenarios where they recommend disabling BASL: 1) the network is not fully routed and 2) you need to control the flow of replication manually. Generally, you have the second scenario because of the first or you have an enormous environment that doesn’t allow for natural replication paths.</p>
<p><a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/creating-a-site-link-bridge-design">https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/creating-a-site-link-bridge-design</a></p>
<p>Obviously, I’m doing it because our sites aren’t intended to communicate. Why create links that won’t work anyway. So let’s just turn it off. If for some reason you were relying on Bridge All Site Links for something, you can simply setup a manual site link bridge between those site links.</p>
<p><img alt="" src="https://activedirectorykc.wordpress.com/wp-content/uploads/2022/08/3_iptransports.png?w=201" /></p>
<ol>
<li>Login to one of the root domain controllers</li>
<li>Launch AD Sites and Services</li>
<li>Expand Sites</li>
<li>Expand “Inter-Site Transports”</li>
<li>Right-Click “IP” \ Choose “Properties”</li>
<li>On the General Tab \ Uncheck “Bridge all site links”</li>
</ol>
<p><img alt="" src="https://activedirectorykc.wordpress.com/wp-content/uploads/2022/08/4_ip_basl.png?w=404" /></p>
<h4 id="disabled-via-powershell">Disabled via Powershell</h4>
<div class="highlight"><pre><span></span><code>$ConfigDN = (Get-ADRootDSE).configurationNamingContext
Set-ADObject -Identity &quot;CN=IP,CN=Inter-Site Transports,CN=Sites,$ConfigDN&quot; -Replace @{&quot;options&quot;=2}
</code></pre></div>
<p>According to the Open Protocol Information put out by Microsoft, there are only two options that can be configured on the Inter-Site Transports containers (IP or SMTP): Ignore Schedules and Bridge All Site Links. I think the likelihood of running into a scenario where the -Replace option for Powershell overwriting an existing option is remote. If you are concerned, use Get-ADObject to confirm your current configuration and adjust accordingly. See the below link to see the different options for the IP Container.</p>
<p><a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/66db6a63-52d2-4980-b87b-7b2d598dba81">https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/66db6a63-52d2-4980-b87b-7b2d598dba81</a></p>
<h3 id="changing-how-ad-srv-records-are-registered">Changing How AD SRV Records are Registered</h3>
<p>Normally, AD does some cool stuff with SRV record registration. Specifically, DCs will log and respond to generic SRV records created in the root domain of a forest to help locate global catalogs services such as LDAP and Kerberos, among other things. These generic records act as fallback records if a site loses its DCs for whatever reason. A client will simply find a random DC to talk to so communication stays up.</p>
<p>Since we’ve firewalled off our different sites, I  don’t want a bunch of site records in the root of the domain that just go anywhere. I want only the root DC records in the root and the specific sub-domain DC records in their specific domains. The root will be able to handle if something goes wrong with the site but not another domain.</p>
<p>Let’s look at the defaults and then decide what to do.</p>
<ol>
<li>Launch DNS Management (dnsmgmt.msc)</li>
<li>Expand Forward Lookup Zones</li>
<li>Expand your root domain name</li>
<li>Click on _tcp</li>
<li>Specifically we are looking at the _gc records</li>
</ol>
<p><img alt="" src="https://activedirectorykc.wordpress.com/wp-content/uploads/2022/08/5_gc_srv_records.png?w=648" /></p>
<p>Notice how we have a GC record for every domain controller in the domain. AD logs a record for each GC, and other records, in a generic record to help with DC Locator. First a client will try to locate a DC in its site and if that fails it passes up to the root “generic” records and receives a random entry that can be any domain controller in the domain or forest.</p>
<p>You can view the site entries with the following nslookup query to return GCs only in the OPS site.</p>
<div class="highlight"><pre><span></span><code>nslookup -type=srv _gc._tcp.OPS._sites.company.pri
</code></pre></div>
<p><img alt="" src="https://activedirectorykc.wordpress.com/wp-content/uploads/2022/08/6_gc_site_record_lookup.png?w=666" /></p>
<p>So the scenario we are looking at is that if a client looks for a GC in its site, either of the OPS DCs can respond. That is what we want. However, if a DC in the OPS site cannot respond or doesn’t respond fast enough, DC Locator may step up and try to do a generic query to _gc._tcp.Company.Pri. That query can return any DC in the forest. If had blocked 3268/3269 or any communication is lost between my host and these DCs, how are GC queries supposed to work? It could possibly sit there and loop through the list of GCs until it finds a server it can talk to or it times out (55 hops).</p>
<p>Never fear! There is a solution to this problem. We need to create a Group Policy. Actually, we need several.</p>
<p><strong>==DO NOT LINK THIS POLICY IN THE ROOT SITE/DOMAIN!!!==</strong></p>
<ol>
<li>Launch Group Policy Management Editor</li>
<li>Create a new policy called “DC DNS Registration” or something similar.</li>
<li>Edit the new policy.</li>
<li>Browse to “Computer Configuration \ Policies \ Administrative Templates \ System \ Net Logon \ DC Locator”</li>
<li>Double Click the setting “Specify DC Locator DNS records not registered by the DCs”</li>
<li>Specify the following values (I will cover these in the Digging Deeper section later).<br />
<code>DC DcByGuid Gc GcIpAddress GenericGC Kdc Ldap LdapIpAddress Rfc1510UpdKdc Rfc1510Kpwd Rfc1510UpdKdc Rfc1510UdpKpwd</code></li>
<li>Close out the group policy editor and save the policy</li>
<li>In GPMC Right-Click “Domains” \ Choose “Show Domains”</li>
<li>Choose one of the other child domains (<strong>Note:</strong> this must be done in the root if you killed 389)</li>
<li>Right-Click the “DC DNS Registration” policy \ Choose “Copy”</li>
<li>Navigate to one of the other child domains in GPMC \ Expand “Group Policy Objects”</li>
<li>Right Click “Group Policy Objects” \ Choose “Paste”</li>
<li>Next through the prompts to copy the policy</li>
<li>Link the policy to the Domain Controllers OU in the child domains.<br />
<strong>NOTE:</strong> For the love of all that is holy, please test the policy before going nuts and linking it in prod. If you brick your prod, it isn’t my fault!</li>
<li>Login to one of the child DCs and run gpupdate /force. I also suggest rebooting</li>
<li>Repeat this process for other child domains.</li>
</ol>
<p>You may not have to reboot – most administrative template GPOs are real-time and take effect immediately without reboot. However, with computer policies its hard to predict. We also need the Netlogon service to restart as that will remove the old DNS records (assuming Dynamic DNS Registration is turned on).</p>
<p>When the server comes back up, login and check your records. You may need to bounce Netlogon a couple of times and do an ipconfig /registerdns to clear the old records. Ultimately, if the records don’t go away you can delete them manually out of DNS and they should not re-register.</p>
<p><img alt="" src="https://activedirectorykc.wordpress.com/wp-content/uploads/2022/08/7_gc_site_record_aftergpo.png?w=635" /></p>
<p>You can see that the list got smaller with those records removed. Now if a GC in the local site cannot be resolved, we head up to the root for help instead of finding a random server in some random site/domain. I ran through my checks and everything looked healthy so this worked. You may receive some errors with nltest looking cross domains as those domains cannot talk and you will receive errors in the <code>repadmin /replsum</code> since the environment isn’t fully routed.</p>
<h2 id="conclusion">Conclusion</h2>
<p>I hope this helped you out! Send me a message or leave a comment if you have questions or if there is something else you’d like me to cover. As always, test in non-prod or test environments before implementing any of this in production. See the below sections for references I used and some deeper dives into a couple of areas.</p>
<h2 id="references">References</h2>
<p>Site Link Bridge Design<br />
<a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/creating-a-site-link-bridge-design">https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/creating-a-site-link-bridge-design</a></p>
<p>Enable or Disable Site Link Bridges<br />
<a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc738789(v=ws.10)">https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc738789(v=ws.10)</a></p>
<p>Preventing Spoke DCs from Advertising in the Hub for Authentication and Availability<br />
<a href="https://support.microsoft.com/en-us/help/816587/how-to-verify-that-srv-dns-records-have-been-created-for-a-domain-cont">https://support.microsoft.com/en-us/help/816587/how-to-verify-that-srv-dns-records-have-been-created-for-a-domain-cont</a></p>
<p>How to verify that SRV DNS Records have been created for a DC<br />
<a href="https://support.microsoft.com/en-us/help/816587/how-to-verify-that-srv-dns-records-have-been-created-for-a-domain-cont">https://support.microsoft.com/en-us/help/816587/how-to-verify-that-srv-dns-records-have-been-created-for-a-domain-cont</a></p>
<p>Optimize Location of a DC or GC<br />
<a href="https://support.microsoft.com/en-us/help/306602/how-to-optimize-the-location-of-a-domain-controller-or-global-catalog">https://support.microsoft.com/en-us/help/306602/how-to-optimize-the-location-of-a-domain-controller-or-global-catalog</a></p>
<p>IP Container Bitmasks<br />
<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/66db6a63-52d2-4980-b87b-7b2d598dba81">https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/66db6a63-52d2-4980-b87b-7b2d598dba81</a></p>
<p>AD Firewall Stuff<br />
<a href="https://support.microsoft.com/en-us/help/179442/how-to-configure-a-firewall-for-domains-and-trusts">https://support.microsoft.com/en-us/help/179442/how-to-configure-a-firewall-for-domains-and-trusts</a></p>
<p>Change Notification and You<br />
<a href="https://blogs.msdn.microsoft.com/canberrapfe/2012/03/25/active-directory-replication-change-notification-you/">https://blogs.msdn.microsoft.com/canberrapfe/2012/03/25/active-directory-replication-change-notification-you/</a></p>
<p>You are not smarter than the KCC</p>
<p><a href="https://blogs.technet.microsoft.com/markmoro/2011/08/05/you-are-not-smarter-than-the-kcc/">https://blogs.technet.microsoft.com/markmoro/2011/08/05/you-are-not-smarter-than-the-kcc/</a></p>
<h2 id="digging-deeper">Digging Deeper</h2>
<h3 id="windows-firewall-configuration-to-lock-down-child-domains">Windows Firewall Configuration to Lock Down Child Domains</h3>
<p>As I mentioned above, I used Windows Firewall to lock down my sites and domains to prevent communication. Here are the settings I used and some reasoning behind my choices. I would not advise blocking 389 as it really screws with some management functions and can slow down AD (though in production you should be using 636 anyway). To block replication you should focus on the RPC Dynamic Range. You would probably want to do more blocks and more restrictions if you wanted to actually block two child domains.</p>
<p>Ultimately, I would recommend doing these configurations with hardware firewalls and the like. This isn’t really a sound use-case for Windows Firewall.</p>
<p>==<strong>NOTE:</strong> DO NOT LINK THIS POLICY IN THE ROOT DOMAIN!!==</p>
<ol>
<li>Launch Group Policy Management Center</li>
<li>Expand Domains \ Select the domain that you wish to create the policy in</li>
<li>Right-Click “Group Policy Objects” \ New</li>
<li>Name the policy</li>
<li>Right-Click the new policy \ Edit</li>
<li>Navigate to “Computer Configuration \ Policies \ Windows Settings \ Security Settings”</li>
<li>Expand “Windows Firewall with Advanced Security”</li>
<li>Expand “Windows Firewall with Advanced Security” (Firewall Icon)</li>
<li>Click “Inbound Rule”</li>
<li>Right-Click “New Rule”</li>
<li>Choose Port</li>
<li>Leave TCP Selected</li>
<li>Configure the following ports: 389, 49152-65535</li>
<li>Choose to “Block the connection”</li>
<li>Leave all profiles selected</li>
<li>Name the firewall rule (e.g. Block TCP 389, 49152-65535)</li>
<li>Find the rule you just created \ Right-Click the rule \ Properties</li>
<li>Click the “Scope” tab</li>
<li>Select “These IPs under Remote IP Address”</li>
<li>Add the different IPs of of the DCs you DO NOT want to talk to the DC this rule applies to.</li>
<li>Click OK</li>
<li>Repeate 10 – 21 except configuring UDP instead of TCP.</li>
<li>Repeat this process again for each domain you wish to lock down making sure to configure the correct IPs in the scope section.<br />
    DO NOT DO THIS IN THE ROOT DOMAIN</li>
<li>Link the policies where appropriate.</li>
</ol>
<p>If you have separate sites in your root domain that you would like to lock down you’ll need to use Security Filtering with Group Policy to target the DCs that you wish to restrict. I would avoid using site policies, even though this seems like a use case, as they don’t always behave as you would expect and most admins don’t know to check for or pay attention to them.</p>
<p>If you wish to get more specific about what is being blocked, you can narrow down which ports are used for AD to a very granular level. See the “More Information” section and the “Windows Server 2008 and later versions” section for the latest and greatest port list in the below link.</p>
<p><a href="https://support.microsoft.com/en-us/help/179442/how-to-configure-a-firewall-for-domains-and-trusts">https://support.microsoft.com/en-us/help/179442/how-to-configure-a-firewall-for-domains-and-trusts</a></p>
<h3 id="site-links-vs-site-link-bridges">Site Links vs Site Link Bridges</h3>
<p>I’m not going to lie to you. I honestly see no real use case for a Site Link Bridge. In my opinion Site Links cover the same topic and work fine. However, Microsoft has them so let’s take a minute to talk about them.</p>
<p>First, some definitions.</p>
<p><strong>Site Links</strong> are objects that represent logical paths that the KCC uses to establish connections for Active Directory replication. Sites contained within a site link use the same network cost to communicate through the specified inter-site transport (IP. SMTP is a relic of the past). Any sites in a site link are said to be connected by the means of the same network type. They are not intended to mirror actual network paths so redundant links is superfluous. When a site link is created between two sites, the KCC/ISTG automatically creates connections between DCs in each site via Bridgehead servers.</p>
<p><strong>Site Link Bridges</strong> are similar, they represent a set of site links that can communicate using the same transport. Bridges are used represent more indirect connections. The replication traffic will likely have to traverse more complicated routes to get from one site to another. The default is for the KCC to assume transitivity between all site links and thus create bridges in its own topology. The KCC will use any combination of included site links to establish the least expensive route to interconnect the domain controllers. The KCC adds up the cost of each additional site link and uses that sum for the bridged path’s cost.</p>
<p>Basically it breaks down to this: Site Links are for direct connections that would be physically adjacent networks and Site Link Bridges are used to connect networks that are not directly connected and must communicate via an intermediary.</p>
<p><a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/replication/active-directory-replication-concepts#BKMK_6">https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/replication/active-directory-replication-concepts#BKMK_6</a></p>
<h3 id="gpo-settings-overview">GPO Settings Overview</h3>
<p>Above we configured the Net Logon group policy to skip over specific records when Netlogon dynamically registers records. I blindly gave a list without much information about the list and promised I would cover it more detail.</p>
<p>Here is the list of settings I chose:</p>
<ul>
<li>DC</li>
<li>DcByGuid</li>
<li>Gc</li>
<li>GcIpAddress</li>
<li>GenericGC</li>
<li>Kdc</li>
<li>Ldap</li>
<li>LdapIpAddress</li>
<li>Rfc1510UpdKdc</li>
<li>Rfc1510Kpwd</li>
<li>Rfc1510UpdKdc</li>
<li>Rfc1510UdpKpwd</li>
<li>Rfc1510UpdKdc</li>
</ul>
<p>If you look at the policy setting itself, it gives us a list of what these settings do, except it is terribly hard to read. I copied the list out and formatted it for easier reading. I have bolded the one’s we are using.</p>
<table>
<thead>
<tr>
<th>GPO Setting</th>
<th>Record Type</th>
<th>Record FQDN</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>LdapIpAddress</strong></td>
<td><strong>A</strong></td>
<td><strong><DnsDomainName></strong></td>
</tr>
<tr>
<td><strong>Ldap</strong></td>
<td><strong>SRV</strong></td>
<td><strong>_ldap._tcp.<DnsDomainName></strong></td>
</tr>
<tr>
<td>LdapAtSite</td>
<td>SRV</td>
<td>_ldap._tcp.<SiteName>._sites.<DnsDomainName></td>
</tr>
<tr>
<td>Pdc</td>
<td>SRV</td>
<td>_ldap._tcp.pdc._msdcs.<DnsDomainName></td>
</tr>
<tr>
<td><strong>Gc</strong></td>
<td><strong>SRV</strong></td>
<td><strong>_ldap._tcp.gc._msdcs.<DnsForestName></strong></td>
</tr>
<tr>
<td>GcAtSite</td>
<td>SRV</td>
<td>_ldap._tcp.<SiteName>._sites.gc._msdcs.<DnsForestName></td>
</tr>
<tr>
<td><strong>DcByGuid</strong></td>
<td><strong>SRV</strong></td>
<td><strong>_ldap._tcp.<DomainGuid>.domains._msdcs.<DnsForestName></strong></td>
</tr>
<tr>
<td><strong>GcIpAddress</strong></td>
<td><strong>A</strong></td>
<td><strong>gc._msdcs.<DnsForestName></strong></td>
</tr>
<tr>
<td>DsaCname</td>
<td>CNAME</td>
<td><DsaGuid>._msdcs.<DnsForestName></td>
</tr>
<tr>
<td><strong>Kdc</strong></td>
<td><strong>SRV</strong></td>
<td><strong>_kerberos._tcp.dc._msdcs.<DnsDomainName></strong></td>
</tr>
<tr>
<td>KdcAtSite</td>
<td>SRV</td>
<td>_kerberos._tcp.<SiteName>._sites.dc._msdcs.<DnsDomainName></td>
</tr>
<tr>
<td><strong>Dc</strong></td>
<td><strong>SRV</strong></td>
<td><strong>_ldap._tcp.dc._msdcs.<DnsDomainName></strong></td>
</tr>
<tr>
<td>DcAtSite</td>
<td>SRV</td>
<td>_ldap._tcp.<SiteName>._sites.dc._msdcs.<DnsDomainName></td>
</tr>
<tr>
<td><strong>Rfc1510Kdc</strong></td>
<td><strong>SRV</strong></td>
<td><strong>_kerberos._tcp.<DnsDomainName></strong></td>
</tr>
<tr>
<td>Rfc1510KdcAtSite</td>
<td>SRV</td>
<td>_kerberos._tcp.<SiteName>._sites.<DnsDomainName></td>
</tr>
<tr>
<td><strong>GenericGc</strong></td>
<td><strong>SRV</strong></td>
<td><strong>_gc._tcp.<DnsForestName></strong></td>
</tr>
<tr>
<td>GenericGcAtSite</td>
<td>SRV</td>
<td>_gc._tcp.<SiteName>._sites.<DnsForestName></td>
</tr>
<tr>
<td><strong>Rfc1510UdpKdc</strong></td>
<td><strong>SRV</strong></td>
<td><strong>_kerberos._udp.<DnsDomainName></strong></td>
</tr>
<tr>
<td><strong>Rfc1510Kpwd</strong></td>
<td><strong>SRV</strong></td>
<td><strong>_kpasswd._tcp.<DnsDomainName></strong></td>
</tr>
<tr>
<td><strong>Rfc1510UdpKpwd</strong></td>
<td><strong>SRV</strong></td>
<td><strong>_kpasswd._udp.<DnsDomainName></strong></td>
</tr>
</tbody>
</table>
<p>This chat makes it pretty easy to see what is going on. We are preventing DCs from registering any generic records and only allowing them to register records in their site. This way if a client cannot find a DC in its site, only the Root DCs will have registered records for the clients to reach out to.</p>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 - 2025 Tyler Jacobs
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/ActiveDirectoryKC" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/thetylerjacobs" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://reddit.com/r/ActiveDirectory" target="_blank" rel="noopener" title="reddit.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M64 32h320c35.3 0 64 28.7 64 64v320c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96c0-35.3 28.7-64 64-64m241.9 134.4c20.6 0 37.3-16.7 37.3-37.3s-16.7-37.3-37.3-37.3c-18 0-33.1 12.8-36.6 29.8-30.2 3.2-53.8 28.8-53.8 59.9v.2c-32.8 1.4-62.8 10.7-86.6 25.5-8.8-6.8-19.9-10.9-32-10.9-28.9 0-52.3 23.4-52.3 52.3 0 21 12.3 39 30.1 47.4 1.7 60.7 67.9 109.6 149.3 109.6s147.6-48.9 149.3-109.7c17.7-8.4 29.9-26.4 29.9-47.3 0-28.9-23.4-52.3-52.3-52.3-12 0-23 4-31.9 10.8-24-14.9-54.3-24.2-87.5-25.4v-.1c0-22.2 16.5-40.7 37.9-43.7 3.9 16.5 18.7 28.7 36.3 28.7zM155 248.1c14.6 0 25.8 15.4 25 34.4s-11.8 25.9-26.5 25.9-27.5-7.7-26.6-26.7 13.5-33.5 28.1-33.5zm166.4 33.5c.9 19-12 26.7-26.6 26.7s-25.6-6.9-26.5-25.9 10.3-34.4 25-34.4 27.3 14.6 28.1 33.5zm-42.1 49.6c-9 21.5-30.3 36.7-55.1 36.7s-46.1-15.1-55.1-36.7c-1.1-2.6.7-5.4 3.4-5.7 16.1-1.6 33.5-2.5 51.7-2.5s35.6.9 51.7 2.5c2.7.3 4.5 3.1 3.4 5.7"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://reddit.com/u/poolmanjim" target="_blank" rel="noopener" title="reddit.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M373 138.6c-25.2 0-46.3-17.5-51.9-41-30.6 4.3-54.2 30.7-54.2 62.4v.2c47.4 1.8 90.6 15.1 124.9 36.3 12.6-9.7 28.4-15.5 45.5-15.5 41.3 0 74.7 33.4 74.7 74.7 0 29.8-17.4 55.5-42.7 67.5-2.4 86.8-97 156.6-213.2 156.6S45.5 410.1 43 323.4c-25.4-11.9-43-37.7-43-67.7C0 214.4 33.4 181 74.7 181c17.2 0 33 5.8 45.7 15.6 34-21.1 76.8-34.4 123.7-36.4v-.3c0-44.3 33.7-80.9 76.8-85.5C325.8 50.2 347.2 32 373 32c29.4 0 53.3 23.9 53.3 53.3s-23.9 53.3-53.3 53.3M157.5 255.3c-20.9 0-38.9 20.8-40.2 47.9s17.1 38.1 38 38.1 36.6-9.8 37.8-36.9-14.7-49.1-35.7-49.1zM395 303.1c-1.2-27.1-19.2-47.9-40.2-47.9s-36.9 22-35.7 49.1 16.9 36.9 37.8 36.9 39.3-11 38-38.1zm-60.1 70.8c1.5-3.6-1-7.7-4.9-8.1-23-2.3-47.9-3.6-73.8-3.6s-50.8 1.3-73.8 3.6c-3.9.4-6.4 4.5-4.9 8.1 12.9 30.8 43.3 52.4 78.7 52.4s65.8-21.6 78.7-52.4"/></svg>
    </a>
  
    
    
    
    
    <a href="https://discordapp.com/users/316222972501295104" target="_blank" rel="noopener" title="@poolmanjim" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.top", "toc.integrate", "search.highlight", "content.code.annotate", "content.grid"], "search": "../../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>